<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Tuts+ Chat Application</title>
    <meta name="description" content="Tuts+ Chat Application" />
    <link rel="stylesheet" href="chat.css" />
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore.js"></script>

    <script>
        // Initialize Firebase with your configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDrJQcdwGklLlPDmXJw8jP7CInqZwVtnLI",
            authDomain: "vthacks11-399205.firebaseapp.com",
            projectId: "vthacks11-399205",
            storageBucket: "vthacks11-399205.appspot.com",
            messagingSenderId: "1084270193305",
            appId: "1:1084270193305:web:41a64b275913cfb17ba608",
            measurementId: "G-93C7BS1XFX"
        };

        firebase.initializeApp(firebaseConfig);

        // Reference to the Firestore collection
        const db = firebase.firestore();
        const chatMessagesRef = db.collection("chatMessages");

        // Function to handle form submission
        $("form[name='message']").submit(function (event) {
            event.preventDefault();

            const userMessage = $("#usermsg").val();

            if (userMessage !== "") {
                const timestamp = new Date().toISOString();

                // Add the message to Firestore
                chatMessagesRef.add({
                    text: userMessage,
                    timestamp: timestamp,
                    sender: "User" // You can replace this with the actual sender's information
                });

                // Clear the input field
                $("#usermsg").val("");
            }
        });

        // Real-time listener to display messages
        chatMessagesRef.orderBy("timestamp").onSnapshot(snapshot => {
            $("#chatbox").empty(); // Clear the chat box

            snapshot.forEach(doc => {
                const messageData = doc.data();
                $("#chatbox").append("<p>" + messageData.sender + ": " + messageData.text + "</p>");
            });
        });
    </script>
</head>
<body>
    <div id="wrapper">
        <div id="menu">
            <p class="welcome">Welcome, <b></b></p>
            <p class="logout"><a id="exit" href="main_page.html">Exit Chat</a></p>
        </div>
        <div id="chatbox"></div>
        <form name="message" action="" method="post">
            <input name="usermsg" type="text" id="usermsg" />
            <button name="submitmsg" type="submit" id="submitmsg">Send</button>
        </form>
    </div>
</body>
</html>
